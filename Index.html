<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品管理系統</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }
    </style>
</head>
<body>
    <h1>商品管理系統</h1>

    <!-- 查詢商品 -->
    <div class="mb-4">
        <h3>查詢商品列表</h3>
        <button class="btn btn-primary" onclick="getProducts()">顯示所有商品</button>
        <div id="product-list" class="mt-4"></div>
    </div>

    <!-- 新增商品 -->
    <div class="mb-4">
        <h3>新增商品</h3>
        <form id="create-product-form">
            <div class="mb-3">
                <label for="productName" class="form-label">商品名稱</label>
                <input type="text" id="productName" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="price" class="form-label">價格</label>
                <input type="number" id="price" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-success">新增商品</button>
        </form>
    </div>

    <!-- 商品詳細 -->
    <div class="mb-4">
        <h3>查詢商品詳細</h3>
        <input type="number" id="product-id" placeholder="輸入商品ID" class="form-control mb-2">
        <button class="btn btn-info" onclick="getProductById()">查詢商品</button>
        <div id="product-detail" class="mt-4"></div>
    </div>

    <script>
        // 查詢商品列表
        async function getProducts() {
            try {
                const response = await fetch('/products');
                const products = await response.json();
                const productList = document.getElementById('product-list');
                productList.innerHTML = '';

                products.results.forEach(product => {
                    const productItem = `
                        <div class="card mb-2">
                            <div class="card-body">
                                <h5 class="card-title">${product.product_name}</h5>
                                <p class="card-text">價格: ${product.amount}</p>
                                <button class="btn btn-danger" onclick="deleteProduct(${product.product_id})">刪除</button>
                            </div>
                        </div>
                    `;
                    productList.innerHTML += productItem;
                });
            } catch (error) {
                console.error('查詢商品失敗:', error);
            }
        }

        // 查詢單一商品
        async function getProductById() {
            const productId = document.getElementById('product-id').value;
            try {
                const response = await fetch(`/products/${productId}`);
                if (response.status === 200) {
                    const product = await response.json();
                    document.getElementById('product-detail').innerHTML = `
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${product.product_name}</h5>
                                <p class="card-text">價格: ${product.amount}</p>
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('product-detail').innerHTML = '商品未找到';
                }
            } catch (error) {
                console.error('查詢商品詳細失敗:', error);
            }
        }

        // 新增商品
        document.getElementById('create-product-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const productName = document.getElementById('productName').value;
            const price = document.getElementById('price').value;

            const data = {
                productName: productName,
                price: price
            };

            try {
                const response = await fetch('/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.status === 201) {
                    alert('商品新增成功');
                    getProducts();
                } else {
                    alert('新增商品失敗');
                }
            } catch (error) {
                console.error('新增商品失敗:', error);
            }
        });

        // 刪除商品
        async function deleteProduct(productId) {
            try {
                const response = await fetch(`/products/${productId}`, { method: 'DELETE' });
                if (response.status === 204) {
                    alert('商品刪除成功');
                    getProducts();
                } else {
                    alert('刪除商品失敗');
                }
            } catch (error) {
                console.error('刪除商品失敗:', error);
            }
        }
    </script>
</body>
</html>
